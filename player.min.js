"use strict";var sampleplayer=sampleplayer||{};sampleplayer.CastPlayer=function(e){this.debug_=!1,this.debug_&&(cast.player.api.setLoggerLevel(cast.player.api.LoggerLevel.DEBUG),cast.receiver.logger.setLevelValue(cast.receiver.LoggerLevel.DEBUG)),this.element_=e,this.type_,this.setType_(sampleplayer.Type.UNKNOWN,!1),this.state_,this.lastStateTransitionTime_=0,this.setState_(sampleplayer.State.LAUNCHING,!1),this.burnInPreventionIntervalId_,this.idleTimerId_,this.seekingTimerId_,this.setStateDelayTimerId_,this.currentApplicationState_,this.progressBarInnerElement_=this.getElementByClass_(".controls-progress-inner"),this.progressBarThumbElement_=this.getElementByClass_(".controls-progress-thumb"),this.curTimeElement_=this.getElementByClass_(".controls-cur-time"),this.totalTimeElement_=this.getElementByClass_(".controls-total-time"),this.previewModeTimerElement_=this.getElementByClass_(".preview-mode-timer-countdown"),this.bufferingHandler_=this.onBuffering_.bind(this),this.player_=null,this.preloadPlayer_=null,this.textTrackType_=null,this.playerAutoPlay_=!1,this.displayPreviewMode_=!1,this.deferredPlayCallbackId_=null,this.playerReady_=!1,this.metadataLoaded_=!1,this.mediaElement_=this.element_.querySelector("video"),this.mediaElement_.addEventListener("error",this.onError_.bind(this),!1),this.mediaElement_.addEventListener("playing",this.onPlaying_.bind(this),!1),this.mediaElement_.addEventListener("pause",this.onPause_.bind(this),!1),this.mediaElement_.addEventListener("ended",this.onEnded_.bind(this),!1),this.mediaElement_.addEventListener("abort",this.onAbort_.bind(this),!1),this.mediaElement_.addEventListener("timeupdate",this.onProgress_.bind(this),!1),this.mediaElement_.addEventListener("seeking",this.onSeekStart_.bind(this),!1),this.mediaElement_.addEventListener("seeked",this.onSeekEnd_.bind(this),!1),this.receiverManager_=cast.receiver.CastReceiverManager.getInstance(),this.receiverManager_.onReady=this.onReady_.bind(this),this.receiverManager_.onSenderDisconnected=this.onSenderDisconnected_.bind(this),this.receiverManager_.onVisibilityChanged=this.onVisibilityChanged_.bind(this),this.receiverManager_.setApplicationState(sampleplayer.getApplicationState_()),this.mediaManager_=new cast.receiver.MediaManager(this.mediaElement_),this.onLoadOrig_=this.mediaManager_.onLoad.bind(this.mediaManager_),this.mediaManager_.onLoad=this.onLoad_.bind(this),this.onEditTracksInfoOrig_=this.mediaManager_.onEditTracksInfo.bind(this.mediaManager_),this.mediaManager_.onEditTracksInfo=this.onEditTracksInfo_.bind(this),this.onMetadataLoadedOrig_=this.mediaManager_.onMetadataLoaded.bind(this.mediaManager_),this.mediaManager_.onMetadataLoaded=this.onMetadataLoaded_.bind(this),this.onStopOrig_=this.mediaManager_.onStop.bind(this.mediaManager_),this.mediaManager_.onStop=this.onStop_.bind(this),this.onLoadMetadataErrorOrig_=this.mediaManager_.onLoadMetadataError.bind(this.mediaManager_),this.mediaManager_.onLoadMetadataError=this.onLoadMetadataError_.bind(this),this.onErrorOrig_=this.mediaManager_.onError.bind(this.mediaManager_),this.mediaManager_.onError=this.onError_.bind(this),this.mediaManager_.customizedStatusCallback=this.customizedStatusCallback_.bind(this),this.mediaManager_.onPreload=this.onPreload_.bind(this),this.mediaManager_.onCancelPreload=this.onCancelPreload_.bind(this)},sampleplayer.IDLE_TIMEOUT={LAUNCHING:3e5,LOADING:3e5,PAUSED:12e5,DONE:3e5,IDLE:3e5},sampleplayer.Type={AUDIO:"audio",VIDEO:"video",UNKNOWN:"unknown"},sampleplayer.TextTrackType={SIDE_LOADED_TTML:"ttml",SIDE_LOADED_VTT:"vtt",SIDE_LOADED_UNSUPPORTED:"unsupported",EMBEDDED:"embedded"},sampleplayer.CaptionsMimeType={TTML:"application/ttml+xml",VTT:"text/vtt"},sampleplayer.TrackType={AUDIO:"audio",VIDEO:"video",TEXT:"text"},sampleplayer.State={LAUNCHING:"launching",LOADING:"loading",BUFFERING:"buffering",PLAYING:"playing",PAUSED:"paused",DONE:"done",IDLE:"idle"},sampleplayer.BURN_IN_TIMEOUT=3e4,sampleplayer.MEDIA_INFO_DURATION_=3e3,sampleplayer.TRANSITION_DURATION_=1.5,sampleplayer.ENABLE_DEBUG_=!0,sampleplayer.DISABLE_DEBUG_=!1,sampleplayer.CastPlayer.prototype.getElementByClass_=function(e){var a=this.element_.querySelector(e);if(a)return a;throw Error("Cannot find element with class: "+e)},sampleplayer.CastPlayer.prototype.getMediaElement=function(){return this.mediaElement_},sampleplayer.CastPlayer.prototype.getMediaManager=function(){return this.mediaManager_},sampleplayer.CastPlayer.prototype.getPlayer=function(){return this.player_},sampleplayer.CastPlayer.prototype.start=function(){this.receiverManager_.start()},sampleplayer.CastPlayer.prototype.preload=function(e){if(this.log_("preload"),sampleplayer.canDisplayPreview_(e||{}))return this.showPreviewMode_(e),!0;if(!sampleplayer.supportsPreload_(e||{}))return this.log_("preload: no supportsPreload_"),!1;this.preloadPlayer_&&(this.preloadPlayer_.unload(),this.preloadPlayer_=null);var a=this.preloadVideo_(e);return a&&this.showPreviewMode_(e),this.log_("preload: couldPreload="+a),a},sampleplayer.CastPlayer.prototype.showPreviewModeMetadata=function(e){this.element_.setAttribute("preview-mode",e.toString())},sampleplayer.CastPlayer.prototype.showPreviewMode_=function(e){this.displayPreviewMode_=!0,this.loadPreviewModeMetadata_(e),this.showPreviewModeMetadata(!0)},sampleplayer.CastPlayer.prototype.hidePreviewMode_=function(){this.showPreviewModeMetadata(!1),this.displayPreviewMode_=!1},sampleplayer.CastPlayer.prototype.createHost=function(e,a,t){var r={};if(r.url=e,r.mediaElement=a,"object"==typeof t.customData){var s=t.customData;s.licenseUrl&&(r.licenseUrl=s.licenseUrl),s.protectionSystem&&(r.protectionSystem=s.protectionSystem),s.licenseCustomData&&(r.licenseCustomData=s.licenseCustomData),r.initialBandwidth=s.initialBandwidth}return this.log_(r),new cast.player.api.Host(r)},sampleplayer.CastPlayer.prototype.getHlsSegmentFormat=function(e){if("object"==typeof e.customData){var a=e.customData;if(a.hlsSegmentFormat)switch(a.hlsSegmentFormat){case"MPEG_AUDIO_ES":return cast.player.api.HlsSegmentFormat.MPEG_AUDIO_ES;case"PACKED_AUDIO_AC3":return cast.player.api.HlsSegmentFormat.PACKED_AUDIO_AC3;case"MPEG_LAYER_3":return cast.player.api.HlsSegmentFormat.MPEG_LAYER_3;case"TS_AAC":return cast.player.api.HlsSegmentFormat.TS_AAC;case"PACKED_AUDIO_E_AC3":return cast.player.api.HlsSegmentFormat.PACKED_AUDIO_E_AC3;default:return cast.player.api.HlsSegmentFormat.MPEG2_TS}}return cast.player.api.HlsSegmentFormat.MPEG2_TS},sampleplayer.CastPlayer.prototype.getIsLive=function(e){if("object"==typeof e.customData){var a=e.customData;if("boolean"==typeof a.isLive&&a.isLive)return!0}return!1},sampleplayer.CastPlayer.prototype.preloadVideo_=function(e){this.log_("preloadVideo_");var a=this,t=e.contentId,r=sampleplayer.getProtocolFunction_(e);if(!r)return this.log_("No protocol found for preload"),!1;var s=this.createHost(t,a.mediaElement_,e);s.onError=function(){a.preloadPlayer_.unload(),a.preloadPlayer_=null,a.showPreviewModeMetadata(!1),a.displayPreviewMode_=!1,a.log_("Error during preload")},a.preloadPlayer_=new cast.player.api.Player(s);var l=this.getHlsSegmentFormat(e),i=this.getIsLive(e);return r===cast.player.api.CreateHlsStreamingProtocol&&l!==cast.player.api.HlsSegmentFormat.MPEG2_TS?i?a.preloadPlayer_.preload(r(s,l),1/0):a.preloadPlayer_.preload(r(s,l)):i?a.preloadPlayer_.preload(r(s),1/0):a.preloadPlayer_.preload(r(s)),!0},sampleplayer.CastPlayer.prototype.load=function(e){this.log_("Loads the given data"),this.log_(e),clearTimeout(this.idleTimerId_);var a=this,t=e.message.media||{},r=t.contentType,s=sampleplayer.getType_(t),l=t.streamType===cast.receiver.media.StreamType.LIVE;if(t.contentId)if(s===sampleplayer.Type.UNKNOWN)this.log_("Load failed: unknown content type: "+r),a.onLoadMetadataError_(e);else{this.log_("Loading: "+s),a.resetMediaElement_(),a.setType_(s,l);var i=!1;switch(s){case sampleplayer.Type.AUDIO:a.loadAudio_(e);break;case sampleplayer.Type.VIDEO:i=a.loadVideo_(e)}a.playerReady_=!1,a.metadataLoaded_=!1,a.loadMetadata_(t),a.showPreviewModeMetadata(!1),a.displayPreviewMode_=!1,sampleplayer.preload_(t,function(){a.log_("preloaded="+i),i?(a.setState_(sampleplayer.State.PLAYING,!1),a.playerReady_=!0,a.maybeSendLoadCompleted_(e),a.deferPlay_(0),a.playerAutoPlay_=!1):sampleplayer.transition_(a.element_,sampleplayer.TRANSITION_DURATION_,function(){a.setState_(sampleplayer.State.LOADING,!1),a.playerReady_=!0,a.maybeSendLoadCompleted_(e),a.playerAutoPlay_&&(a.deferPlay_(sampleplayer.MEDIA_INFO_DURATION_),a.playerAutoPlay_=!1)})})}else this.log_("Load failed: no content"),a.onLoadMetadataError_(e)},sampleplayer.CastPlayer.prototype.maybeSendLoadCompleted_=function(e){this.playerReady_?this.metadataLoaded_?(this.onMetadataLoadedOrig_(e),this.log_("Sent load response, player is ready and metadata loaded")):this.log_("Deferring load response, loadedmetadata event not received"):this.log_("Deferring load response, player not ready")},sampleplayer.CastPlayer.prototype.resetMediaElement_=function(){this.log_("resetMediaElement_"),this.player_&&(this.player_.unload(),this.player_=null),this.textTrackType_=null},sampleplayer.CastPlayer.prototype.loadMetadata_=function(e){if(this.log_("loadMetadata_"),!sampleplayer.isCastForAudioDevice_()){var a=e.metadata||{},t=this.element_.querySelector(".media-title");sampleplayer.setInnerText_(t,a.title);var r=this.element_.querySelector(".media-subtitle");sampleplayer.setInnerText_(r,a.subtitle);var s=sampleplayer.getMediaImageUrl_(e);if(s){var l=this.element_.querySelector(".media-artwork");sampleplayer.setBackgroundImage_(l,s)}}},sampleplayer.CastPlayer.prototype.loadPreviewModeMetadata_=function(e){if(this.log_("loadPreviewModeMetadata_"),!sampleplayer.isCastForAudioDevice_()){var a=e.metadata||{},t=this.element_.querySelector(".preview-mode-title");sampleplayer.setInnerText_(t,a.title);var r=this.element_.querySelector(".preview-mode-subtitle");sampleplayer.setInnerText_(r,a.subtitle);var s=sampleplayer.getMediaImageUrl_(e);if(s){var l=this.element_.querySelector(".preview-mode-artwork");sampleplayer.setBackgroundImage_(l,s)}}},sampleplayer.CastPlayer.prototype.letPlayerHandleAutoPlay_=function(e){this.log_("letPlayerHandleAutoPlay_: "+e.message.autoplay);var a=e.message.autoplay;e.message.autoplay=!1,this.mediaElement_.autoplay=!1,this.playerAutoPlay_=void 0===a||a},sampleplayer.CastPlayer.prototype.loadAudio_=function(e){this.log_("loadAudio_"),this.letPlayerHandleAutoPlay_(e),this.loadDefault_(e)},sampleplayer.CastPlayer.prototype.loadVideo_=function(e){this.log_("loadVideo_");var a=this,t=null,r=e.message.media.contentId;t=sampleplayer.getProtocolFunction_(e.message.media);var s=!1;if(this.letPlayerHandleAutoPlay_(e),t){this.log_("loadVideo_: using Media Player Library"),this.mediaElement_.removeEventListener("stalled",this.bufferingHandler_),this.mediaElement_.removeEventListener("waiting",this.bufferingHandler_);var l=function(){a.player_&&(a.resetMediaElement_(),a.mediaElement_.dispatchEvent(new Event("error")))};if(!this.preloadPlayer_||this.preloadPlayer_.getHost&&this.preloadPlayer_.getHost().url!==r){this.preloadPlayer_&&(this.preloadPlayer_.unload(),this.preloadPlayer_=null),this.log_("Regular video load1");var i=this.createHost(r,this.mediaElement_,e.message.media);i.onError=l,this.player_=new cast.player.api.Player(i);var n=this.getHlsSegmentFormat(e.message.media),o=this.getIsLive(e.message.media);t===cast.player.api.CreateHlsStreamingProtocol&&n!==cast.player.api.HlsSegmentFormat.MPEG2_TS?o?this.player_.load(t(i,n),1/0):this.player_.load(t(i,n)):o?this.player_.load(t(i),1/0):this.player_.load(t(i))}else this.log_("Preloaded video load"),this.player_=this.preloadPlayer_,this.preloadPlayer_=null,this.player_.getHost().onError=l,this.player_.load(),s=!0}else this.log_("loadVideo_: using MediaElement"),this.mediaElement_.addEventListener("stalled",this.bufferingHandler_,!1),this.mediaElement_.addEventListener("waiting",this.bufferingHandler_,!1);return this.loadMediaManagerInfo_(e,!!t),s},sampleplayer.CastPlayer.prototype.loadMediaManagerInfo_=function(e,a){a?this.maybeLoadSideLoadedTracksMetadata_(e):this.loadDefault_(e)},sampleplayer.CastPlayer.prototype.readSideLoadedTextTrackType_=function(e){if(e.message&&e.message.media&&e.message.media.tracks)for(var a=0;a<e.message.media.tracks.length;a++){var t=this.textTrackType_;if(e.message.media.tracks[a].type===cast.receiver.media.TrackType.TEXT){if(this.isTtmlTrack_(e.message.media.tracks[a]))this.textTrackType_=sampleplayer.TextTrackType.SIDE_LOADED_TTML;else{if(!this.isVttTrack_(e.message.media.tracks[a])){this.log_("Unsupported side loaded text track types"),this.textTrackType_=sampleplayer.TextTrackType.SIDE_LOADED_UNSUPPORTED;break}this.textTrackType_=sampleplayer.TextTrackType.SIDE_LOADED_VTT}if(t&&t!==this.textTrackType_){this.log_("Load has inconsistent text track types"),this.textTrackType_=sampleplayer.TextTrackType.SIDE_LOADED_UNSUPPORTED;break}}}},sampleplayer.CastPlayer.prototype.maybeLoadSideLoadedTracksMetadata_=function(e){if(e.message&&e.message.media&&e.message.media.tracks&&0!==e.message.media.tracks.length){var a={tracks:e.message.media.tracks,activeTrackIds:e.message.activeTrackIds,textTrackStyle:e.message.media.textTrackStyle};this.mediaManager_.loadTracksInfo(a)}},sampleplayer.CastPlayer.prototype.maybeLoadEmbeddedTracksMetadata_=function(e){if(e.message&&e.message.media){var a=this.readInBandTracksInfo_();a&&(this.textTrackType_=sampleplayer.TextTrackType.EMBEDDED,a.textTrackStyle=e.message.media.textTrackStyle,this.mediaManager_.loadTracksInfo(a))}},sampleplayer.CastPlayer.prototype.processTtmlCues_=function(e,a){if(0!==e.length)for(var t=0;t<a.length;t++){for(var r=!1,s=0;s<e.length;s++)if(e[s]===a[t].trackId){r=!0;break}if(r&&this.isTtmlTrack_(a[t])){if(!this.player_){var l=new cast.player.api.Host({url:"",mediaElement:this.mediaElement_});this.protocol_=null,this.player_=new cast.player.api.Player(l)}this.player_.enableCaptions(!0,cast.player.api.CaptionsType.TTML,a[t].trackContentId)}}},sampleplayer.CastPlayer.prototype.isTtmlTrack_=function(e){return this.isKnownTextTrack_(e,sampleplayer.TextTrackType.SIDE_LOADED_TTML,sampleplayer.CaptionsMimeType.TTML)},sampleplayer.CastPlayer.prototype.isVttTrack_=function(e){return this.isKnownTextTrack_(e,sampleplayer.TextTrackType.SIDE_LOADED_VTT,sampleplayer.CaptionsMimeType.VTT)},sampleplayer.CastPlayer.prototype.isKnownTextTrack_=function(e,a,t){if(!e)return!1;var r=a,s=e.trackContentId,l=e.trackContentType;return!!(s&&sampleplayer.getExtension_(s)===r||l&&0===l.indexOf(t))},sampleplayer.CastPlayer.prototype.processInBandTracks_=function(e){for(var a=this.player_.getStreamingProtocol(),t=a.getStreamCount(),r=0;r<t;r++){for(var s=r+1,l=!1,i=0;i<e.length;i++)if(e[i]===s){l=!0;break}var n=a.isStreamEnabled(r);l&&!n?a.enableStream(r,!0):!l&&n&&a.enableStream(r,!1)}},sampleplayer.CastPlayer.prototype.readInBandTracksInfo_=function(){var e=this.player_?this.player_.getStreamingProtocol():null;if(!e)return null;for(var a=e.getStreamCount(),t=[],r=[],s=0;s<a;s++){var l=s+1;e.isStreamEnabled(s)&&t.push(l);var i,n=e.getStreamInfo(s),o=n.mimeType;0===o.indexOf(sampleplayer.TrackType.TEXT)||o===sampleplayer.CaptionsMimeType.TTML?i=new cast.receiver.media.Track(l,cast.receiver.media.TrackType.TEXT):0===o.indexOf(sampleplayer.TrackType.VIDEO)?i=new cast.receiver.media.Track(l,cast.receiver.media.TrackType.VIDEO):0===o.indexOf(sampleplayer.TrackType.AUDIO)&&(i=new cast.receiver.media.Track(l,cast.receiver.media.TrackType.AUDIO)),i&&(i.name=n.name,i.language=n.language,i.trackContentType=n.mimeType,r.push(i))}return 0===r.length?null:{tracks:r,activeTrackIds:t}},sampleplayer.CastPlayer.prototype.loadDefault_=function(e){this.onLoadOrig_(new cast.receiver.MediaManager.Event(cast.receiver.MediaManager.EventType.LOAD,e.message,e.senderId))},sampleplayer.CastPlayer.prototype.setIdleTimeout_=function(e){this.log_("setIdleTimeout_: "+e);var a=this;clearTimeout(this.idleTimerId_),e&&(this.idleTimerId_=setTimeout(function(){a.receiverManager_.stop()},e))},sampleplayer.CastPlayer.prototype.setType_=function(e,a){this.log_("setType_: "+e),this.type_=e,this.element_.setAttribute("type",e),this.element_.setAttribute("live",a.toString());var t=this.getElementByClass_(".overlay");clearInterval(this.burnInPreventionIntervalId_),e!==sampleplayer.Type.AUDIO?t.removeAttribute("style"):this.burnInPreventionIntervalId_=setInterval(function(){t.style.marginBottom=Math.round(100*Math.random())+"px",t.style.marginLeft=Math.round(600*Math.random())+"px"},sampleplayer.BURN_IN_TIMEOUT)},sampleplayer.CastPlayer.prototype.setState_=function(e,a,t){this.log_("setState_: state="+e+", crossfade="+a+", delay="+t);var r=this;if(r.lastStateTransitionTime_=Date.now(),clearTimeout(r.delay_),t){r.delay_=setTimeout(function(){r.setState_(e,a)},t)}else if(a){var s=r.lastStateTransitionTime_;sampleplayer.transition_(r.element_,sampleplayer.TRANSITION_DURATION_,function(){s<r.lastStateTransitionTime_?r.log_("discarded obsolete deferred state("+e+")."):r.setState_(e,!1)})}else r.state_=e,r.element_.setAttribute("state",e),r.updateApplicationState_(),r.setIdleTimeout_(sampleplayer.IDLE_TIMEOUT[e.toUpperCase()])},sampleplayer.CastPlayer.prototype.updateApplicationState_=function(){if(this.log_("updateApplicationState_"),this.mediaManager_){var e=this.state_===sampleplayer.State.IDLE?null:this.mediaManager_.getMediaInformation(),a=sampleplayer.getApplicationState_(e);this.currentApplicationState_!==a&&(this.currentApplicationState_=a,this.receiverManager_.setApplicationState(a))}},sampleplayer.CastPlayer.prototype.onReady_=function(){this.log_("onReady"),this.setState_(sampleplayer.State.IDLE,!1)},sampleplayer.CastPlayer.prototype.onSenderDisconnected_=function(e){this.log_("onSenderDisconnected"),0===this.receiverManager_.getSenders().length&&e.reason===cast.receiver.system.DisconnectReason.REQUESTED_BY_SENDER&&this.receiverManager_.stop()},sampleplayer.CastPlayer.prototype.onError_=function(e){this.log_("onError");var a=this;sampleplayer.transition_(a.element_,sampleplayer.TRANSITION_DURATION_,function(){a.setState_(sampleplayer.State.IDLE,!0),a.onErrorOrig_(e)})},sampleplayer.CastPlayer.prototype.onBuffering_=function(){this.log_("onBuffering[readyState="+this.mediaElement_.readyState+"]"),this.state_===sampleplayer.State.PLAYING&&this.mediaElement_.readyState<HTMLMediaElement.HAVE_ENOUGH_DATA&&this.setState_(sampleplayer.State.BUFFERING,!1)},sampleplayer.CastPlayer.prototype.onPlaying_=function(){this.log_("onPlaying"),this.cancelDeferredPlay_("media is already playing");var e=this.type_===sampleplayer.Type.AUDIO,a=this.state_===sampleplayer.State.LOADING&&!e;this.setState_(sampleplayer.State.PLAYING,a)},sampleplayer.CastPlayer.prototype.onPause_=function(){this.log_("onPause"),this.cancelDeferredPlay_("media is paused");var e=this.state_===sampleplayer.State.IDLE,a=this.mediaElement_.currentTime===this.mediaElement_.duration;this.player_&&this.player_.getState().underflow?(this.log_("isUnderflow"),this.setState_(sampleplayer.State.BUFFERING,!1),this.mediaManager_.broadcastStatus(!1)):e||a||this.setState_(sampleplayer.State.PAUSED,!1),this.updateProgress_()},sampleplayer.CastPlayer.prototype.customizedStatusCallback_=function(e){return this.log_("customizedStatusCallback_: playerState="+e.playerState+", this.state_="+this.state_),e.playerState===cast.receiver.media.PlayerState.PAUSED&&this.state_===sampleplayer.State.BUFFERING&&(e.playerState=cast.receiver.media.PlayerState.BUFFERING),e},sampleplayer.CastPlayer.prototype.onStop_=function(e){this.log_("onStop"),this.cancelDeferredPlay_("media is stopped");var a=this;sampleplayer.transition_(a.element_,sampleplayer.TRANSITION_DURATION_,function(){a.setState_(sampleplayer.State.IDLE,!1),a.onStopOrig_(e)})},sampleplayer.CastPlayer.prototype.onEnded_=function(){this.log_("onEnded"),this.setState_(sampleplayer.State.IDLE,!0),this.hidePreviewMode_()},sampleplayer.CastPlayer.prototype.onAbort_=function(){this.log_("onAbort"),this.setState_(sampleplayer.State.IDLE,!0),this.hidePreviewMode_()},sampleplayer.CastPlayer.prototype.onProgress_=function(){this.state_!==sampleplayer.State.BUFFERING&&this.state_!==sampleplayer.State.LOADING||this.setState_(sampleplayer.State.PLAYING,!1),this.updateProgress_()},sampleplayer.CastPlayer.prototype.updateProgress_=function(){if(!sampleplayer.isCastForAudioDevice_()){var e=this.mediaElement_.currentTime,a=this.mediaElement_.duration;if(!isNaN(e)&&!isNaN(a)){var t=e/a*100;this.curTimeElement_.innerText=sampleplayer.formatDuration_(e),this.totalTimeElement_.innerText=sampleplayer.formatDuration_(a),this.progressBarInnerElement_.style.width=t+"%",this.progressBarThumbElement_.style.left=t+"%",this.displayPreviewMode_&&(this.previewModeTimerElement_.innerText=""+Math.round(a-e))}}},sampleplayer.CastPlayer.prototype.onSeekStart_=function(){this.log_("onSeekStart"),clearTimeout(this.seekingTimeoutId_),this.element_.classList.add("seeking")},sampleplayer.CastPlayer.prototype.onSeekEnd_=function(){this.log_("onSeekEnd"),clearTimeout(this.seekingTimeoutId_),this.seekingTimeoutId_=sampleplayer.addClassWithTimeout_(this.element_,"seeking",3e3)},sampleplayer.CastPlayer.prototype.onVisibilityChanged_=function(e){this.log_("onVisibilityChanged"),e.isVisible||(this.mediaElement_.pause(),this.mediaManager_.broadcastStatus(!1))},sampleplayer.CastPlayer.prototype.onPreload_=function(e){this.log_("onPreload_");var a=e.data;return this.preload(a.media)},sampleplayer.CastPlayer.prototype.onCancelPreload_=function(e){return this.log_("onCancelPreload_"),this.hidePreviewMode_(),!0},sampleplayer.CastPlayer.prototype.onLoad_=function(e){this.log_("onLoad_"),this.cancelDeferredPlay_("new media is loaded"),this.load(new cast.receiver.MediaManager.LoadInfo(e.data,e.senderId))},sampleplayer.CastPlayer.prototype.onEditTracksInfo_=function(e){if(this.log_("onEditTracksInfo"),this.onEditTracksInfoOrig_(e),e.data&&e.data.activeTrackIds&&this.textTrackType_){var a=this.mediaManager_.getMediaInformation()||{},t=this.textTrackType_;t===sampleplayer.TextTrackType.SIDE_LOADED_TTML?(this.player_&&this.player_.enableCaptions(!1,cast.player.api.CaptionsType.TTML),this.processTtmlCues_(e.data.activeTrackIds,a.tracks||[])):t===sampleplayer.TextTrackType.EMBEDDED&&(this.player_.enableCaptions(!1),this.processInBandTracks_(e.data.activeTrackIds),this.player_.enableCaptions(!0))}},sampleplayer.CastPlayer.prototype.onMetadataLoaded_=function(e){this.log_("onMetadataLoaded"),this.onLoadSuccess_(),this.readSideLoadedTextTrackType_(e),this.textTrackType_===sampleplayer.TextTrackType.SIDE_LOADED_TTML&&e.message&&e.message.activeTrackIds&&e.message.media&&e.message.media.tracks?this.processTtmlCues_(e.message.activeTrackIds,e.message.media.tracks):this.textTrackType_||this.maybeLoadEmbeddedTracksMetadata_(e),this.metadataLoaded_=!0,this.maybeSendLoadCompleted_(e)},sampleplayer.CastPlayer.prototype.onLoadMetadataError_=function(e){this.log_("onLoadMetadataError_");var a=this;sampleplayer.transition_(a.element_,sampleplayer.TRANSITION_DURATION_,function(){a.setState_(sampleplayer.State.IDLE,!0),a.onLoadMetadataErrorOrig_(e)})},sampleplayer.CastPlayer.prototype.cancelDeferredPlay_=function(e){this.deferredPlayCallbackId_&&(this.log_("Cancelled deferred playback: "+e),clearTimeout(this.deferredPlayCallbackId_),this.deferredPlayCallbackId_=null)},sampleplayer.CastPlayer.prototype.deferPlay_=function(e){this.log_("Defering playback for "+e+" ms");var a=this;this.deferredPlayCallbackId_=setTimeout(function(){a.deferredPlayCallbackId_=null,a.player_?(a.log_("Playing when enough data"),a.player_.playWhenHaveEnoughData()):(a.log_("Playing"),a.mediaElement_.play())},e)},sampleplayer.CastPlayer.prototype.onLoadSuccess_=function(){this.log_("onLoadSuccess");var e=this.mediaElement_.duration;isNaN(e)?(this.totalTimeElement_.textContent="",this.progressBarInnerElement_.style.width="100%",this.progressBarThumbElement_.style.left="100%"):this.totalTimeElement_.textContent=sampleplayer.formatDuration_(e)},sampleplayer.getMediaImageUrl_=function(e){var a=(e.metadata||{}).images||[];return a&&a[0]&&a[0].url},sampleplayer.getProtocolFunction_=function(e){var a=e.contentId,t=e.contentType||"",r=sampleplayer.getPath_(a)||"";return"m3u8"===sampleplayer.getExtension_(r)||"application/x-mpegurl"===t||"application/vnd.apple.mpegurl"===t?cast.player.api.CreateHlsStreamingProtocol:"mpd"===sampleplayer.getExtension_(r)||"application/dash+xml"===t?cast.player.api.CreateDashStreamingProtocol:r.indexOf(".ism")>-1||"application/vnd.ms-sstr+xml"===t?cast.player.api.CreateSmoothStreamingProtocol:null},sampleplayer.supportsPreload_=function(e){return null!==sampleplayer.getProtocolFunction_(e)},sampleplayer.canDisplayPreview_=function(e){var a=e.contentId||"",t=sampleplayer.getPath_(a);return"mp4"===sampleplayer.getExtension_(t)||("ogv"===sampleplayer.getExtension_(t)||"webm"===sampleplayer.getExtension_(t))},sampleplayer.getType_=function(e){var a=e.contentId||"",t=e.contentType||"",r=sampleplayer.getPath_(a);return 0===t.indexOf("audio/")?sampleplayer.Type.AUDIO:0===t.indexOf("video/")?sampleplayer.Type.VIDEO:0===t.indexOf("application/x-mpegurl")?sampleplayer.Type.VIDEO:0===t.indexOf("application/vnd.apple.mpegurl")?sampleplayer.Type.VIDEO:0===t.indexOf("application/dash+xml")?sampleplayer.Type.VIDEO:0===t.indexOf("application/vnd.ms-sstr+xml")?sampleplayer.Type.VIDEO:"mp3"===sampleplayer.getExtension_(r)?sampleplayer.Type.AUDIO:"oga"===sampleplayer.getExtension_(r)?sampleplayer.Type.AUDIO:"wav"===sampleplayer.getExtension_(r)?sampleplayer.Type.AUDIO:"mp4"===sampleplayer.getExtension_(r)?sampleplayer.Type.VIDEO:"ogv"===sampleplayer.getExtension_(r)?sampleplayer.Type.VIDEO:"webm"===sampleplayer.getExtension_(r)?sampleplayer.Type.VIDEO:"m3u8"===sampleplayer.getExtension_(r)?sampleplayer.Type.VIDEO:"mpd"===sampleplayer.getExtension_(r)?sampleplayer.Type.VIDEO:0!==t.indexOf(".ism")?sampleplayer.Type.VIDEO:sampleplayer.Type.UNKNOWN},sampleplayer.formatDuration_=function(e){function a(e){return("00"+Math.round(e)).slice(-2)}e=Math.floor(e);var t=Math.floor(e/3600),r=Math.floor(e/60)%60,s=e%60;return t?a(t)+":"+a(r)+":"+a(s):a(r)+":"+a(s)},sampleplayer.addClassWithTimeout_=function(e,a,t){return e.classList.add(a),setTimeout(function(){e.classList.remove(a)},t)},sampleplayer.transition_=function(e,a,t){a<=0||sampleplayer.isCastForAudioDevice_()?t():sampleplayer.fadeOut_(e,a/2,function(){t(),sampleplayer.fadeIn_(e,a/2)})},sampleplayer.preload_=function(e,a){if(sampleplayer.isCastForAudioDevice_())a();else{var t=[],r=0,s=[],l=sampleplayer.getMediaImageUrl_(e);if(l&&t.push(l),0===t.length)a();else for(var i=0;i<t.length;i++)s[i]=new Image,s[i].src=t[i],s[i].onload=function(){n()},s[i].onerror=function(){n()}}function n(){++r===t.length&&a()}},sampleplayer.fadeIn_=function(e,a,t){sampleplayer.fadeTo_(e,"",a,t)},sampleplayer.fadeOut_=function(e,a,t){sampleplayer.fadeTo_(e,0,a,t)},sampleplayer.fadeTo_=function(e,a,t,r){var s=function(){e.style.webkitTransition="",e.removeEventListener("webkitTransitionEnd",s,!1),r&&r()};e.addEventListener("webkitTransitionEnd",s,!1),e.style.webkitTransition="opacity "+t+"s",e.style.opacity=a},sampleplayer.getExtension_=function(e){var a=e.split(".");return 1===a.length||""===a[0]&&2===a.length?"":a.pop().toLowerCase()},sampleplayer.getApplicationState_=function(e){return e&&e.metadata&&e.metadata.title?"Now Casting: "+e.metadata.title:e?"Now Casting":"Ready To Cast"},sampleplayer.getPath_=function(e){var a=document.createElement("a");return a.href=e,a.pathname||""},sampleplayer.CastPlayer.prototype.log_=function(e){this.debug_&&e&&console.log(e)},sampleplayer.setInnerText_=function(e,a){e&&(e.innerText=a||"")},sampleplayer.setBackgroundImage_=function(e,a){e&&(e.style.backgroundImage=a?'url("'+a.replace(/"/g,'\\"')+'")':"none",e.style.display=a?"":"none")},sampleplayer.isCastForAudioDevice_=function(){var e=window.cast.receiver.CastReceiverManager.getInstance();if(e){var a=e.getDeviceCapabilities();if(a)return!1===a.display_supported}return!1};